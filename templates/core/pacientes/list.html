{% extends 'home.html' %}
{% load static %}

<title>{% block title %}Lista de Pacientes{% endblock %}</title>

{% block content %}
{% include 'fragments/messages.html' %}

<section class="mt-4 bg-white dark:bg-principal">
  <div class="container mx-auto px-4">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 bg-emerald-600 py-3 px-6 rounded-xl shadow-lg text-center uppercase">
      Lista de Pacientes
    </h1>

    <!-- Buscador -->
    <div class="mt-6 flex justify-center">
      <form method="get" class="relative w-full max-w-lg">
        <i class="fa-solid fa-magnifying-glass absolute left-3 top-3.5 text-emerald-500"></i>
        <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Buscar por nombre o apellido..."
               class="w-full pl-10 pr-4 py-2 rounded-lg shadow-md border border-emerald-300
                      focus:outline-none focus:ring-2 focus:ring-emerald-500
                      bg-white text-gray-800 dark:bg-principal dark:text-gray-200">
      </form>
    </div>

    <!-- Tabla -->
    <div class="mt-8 overflow-x-auto rounded-xl shadow-lg border border-emerald-100 dark:border-secundario">
      <table class="w-full text-center text-sm md:text-base">
        <thead class="bg-emerald-100 dark:bg-secundario uppercase text-gray-600 dark:text-emerald-300 font-semibold">
          <tr>
            <th class="py-3 px-4">#</th>
            <th class="py-3 px-4">Nombres</th>
            <th class="py-3 px-4">Apellidos</th>
            <th class="py-3 px-4">Cédula</th>
            <th class="py-3 px-4">Teléfono</th>
            <th class="py-3 px-4">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for paciente in pacientes %}
          <tr class="bg-white dark:bg-[#0b1121] border-b border-emerald-50 dark:border-secundario
                     hover:bg-emerald-50 dark:hover:bg-[#121c33] transition-colors duration-300
                     text-gray-600 dark:text-gray-400">
            <td class="py-4 px-4 font-semibold text-emerald-600">{{ paciente.id }}</td>
            <td class="py-4 px-4">{{ paciente.nombres }}</td>
            <td class="py-4 px-4">{{ paciente.apellidos }}</td>
            <td class="py-4 px-4">{{ paciente.cedula_ecuatoriana }}</td>
            <td class="py-4 px-4">{{ paciente.telefono }}</td>
            <td class="py-4 px-4">
              <div class="flex justify-center space-x-2">
                {% if permissions.change_paciente %}
                <a href="{% url 'core:paciente_update' paciente.id %}" class="text-sky-500 hover:text-sky-700">
                  <i class="fa-solid fa-pen-to-square"></i>
                </a>
                {% endif %}
                {% if permissions.delete_paciente %}
                <a href="{% url 'core:paciente_delete' paciente.id %}" class="text-red-600 hover:text-red-800">
                  <i class="fa-solid fa-trash"></i>
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
              <div class="flex flex-col items-center">
                <i class="fa-solid fa-user-xmark text-4xl mb-2 text-gray-300"></i>
                <p class="text-lg">No se encontraron pacientes</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    {% include 'fragments/pagination.html' with page_obj=page_obj %}

    <!-- Botones -->
    <div class="flex flex-col md:flex-row justify-center p-6 space-y-2 md:space-y-0 md:space-x-2">
      {% if permissions.add_paciente %}
      <a href="{% url 'core:paciente_create' %}"
         class="bg-emerald-700 hover:bg-emerald-800 text-white py-2 px-4 rounded-full shadow transition duration-200 flex items-center justify-center">
        <i class="fa-solid fa-user-plus mr-2"></i> Nuevo Paciente
      </a>
      {% endif %}
      <a href="{% url 'home' %}"
         class="bg-emerald-700 hover:bg-emerald-800 text-white py-2 px-4 rounded-full shadow transition duration-200 flex items-center justify-center">
        <i class="fa-solid fa-house mr-2"></i> Inicio
      </a>
    </div>
  </div>
</section>
{% endblock %}
